"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[58297],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=l(n),m=i,h=c["".concat(p,".").concat(m)]||c[m]||u[m]||r;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=c;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},24635:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>m,frontMatter:()=>s,metadata:()=>l,toc:()=>u});n(67294);var a=n(3905);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const s={title:"Adding CRUD Actions and Authentication",description:"We'll initialize our Pixels app using refine and get familiar with the boilerplate code to be created with the create refine-app CLI tool.",slug:"refine-pixels-3",authors:"abdullah_numan",tags:["refine-week","refine","supabase"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/social.png",hide_table_of_contents:!1},p=void 0,l={permalink:"/blog/refine-pixels-3",source:"@site/blog/2023-02-16-refine-pixels-3.md",title:"Adding CRUD Actions and Authentication",description:"We'll initialize our Pixels app using refine and get familiar with the boilerplate code to be created with the create refine-app CLI tool.",date:"2023-02-16T00:00:00.000Z",formattedDate:"February 16, 2023",tags:[{label:"refine-week",permalink:"/blog/tags/refine-week"},{label:"refine",permalink:"/blog/tags/refine"},{label:"supabase",permalink:"/blog/tags/supabase"}],readingTime:28.495,hasTruncateMarker:!1,authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],frontMatter:{title:"Adding CRUD Actions and Authentication",description:"We'll initialize our Pixels app using refine and get familiar with the boilerplate code to be created with the create refine-app CLI tool.",slug:"refine-pixels-3",authors:"abdullah_numan",tags:["refine-week","refine","supabase"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/social.png",hide_table_of_contents:!1},prevItem:{title:"Adding Realtime Collaboration",permalink:"/blog/refine-pixels-4"},nextItem:{title:"Setting Up the Client App",permalink:"/blog/refine-pixels-2"},relatedPosts:[{title:"Build Fast and Customizable Admin Panel with NestJS",description:"We will prepare a simple `job-posting` application. We will also use the refine framework for the admin panel. The project will consist of two parts, api and admin.",permalink:"/blog/customizable-admin-panel-with-nestjs",formattedDate:"October 4, 2021",authors:[{name:"Y\u0131ld\u0131ray \xdcnl\xfc",title:"Software Developer",url:"https://github.com/yildirayunlu",imageURL:"https://github.com/yildirayunlu.png",key:"yildiray"}],readingTime:4.175,date:"2021-10-04T00:00:00.000Z"},{title:"How to create a notification provider with react-toastify",description:"We'll create a custom notification provider in a refine application using react-toastify.",permalink:"/blog/react-toastify",formattedDate:"June 1, 2023",authors:[{name:"Joseph Mawa",title:"Web Developer",url:"https://github.com/nibble0101",imageURL:"/img/generic-profile.png",key:"joseph_mawa"}],readingTime:13.02,date:"2023-06-01T00:00:00.000Z"},{title:"Adding PDF Renderer",description:"We are going to add PDF renderer to our PDF Invoice Generator app that we have been building last few days. This is also where we summarize our accomplishments and wrap up the series.",permalink:"/blog/refine-react-invoice-generator-5",formattedDate:"April 14, 2023",authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],readingTime:8.835,date:"2023-04-14T00:00:00.000Z"}],authorPosts:[{title:"Adding CRUD Pages",description:"We'll be adding CRUD pages for Company, Client and Contact resources in this post.",permalink:"/blog/refine-react-invoice-generator-3",formattedDate:"April 12, 2023",authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],readingTime:26.965,date:"2023-04-12T00:00:00.000Z"},{title:"Pilot & refine architecture",description:"We'll be taking a look at the architecture of refine and how week of refineWeek series will be structured.",permalink:"/blog/refine-react-invoice-generator-1",formattedDate:"April 10, 2023",authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],readingTime:9.195,date:"2023-04-10T00:00:00.000Z"},{title:"Memoization in React - How useCallback Works",description:"Improve the APP performance with React useCallback() hook",permalink:"/blog/react-usecallback-guide",formattedDate:"September 20, 2022",authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],readingTime:5.4,date:"2022-09-20T00:00:00.000Z"}]},d={authorsImageUrls:[void 0]},u=[{value:"refineWeek series",id:"refineweek-series",level:3},{value:"Overview",id:"overview",level:2},{value:"Setting Up Supabase for Refine",id:"setting-up-supabase-for-refine",level:2},{value:"1. Creating a PostgreSQL Server with Supabase",id:"1-creating-a-postgresql-server-with-supabase",level:3},{value:"2. Adding Tables to a Supabase Database",id:"2-adding-tables-to-a-supabase-database",level:3},{value:"3. Set Up <code>supabaseClient</code> for <code>&lt;Refine /&gt;</code> Providers",id:"3-set-up-supabaseclient-for-refine--providers",level:3},{value:"<code>&lt;Refine /&gt;</code>&#39;s <code>resources</code> Prop",id:"refine-s-resources-prop",level:2},{value:"Adding <code>resources</code> to <code>&lt;Refine /&gt;</code>",id:"adding-resources-to-refine-",level:3},{value:"Adding required files",id:"adding-required-files",level:3},{value:"<code>&lt;Refine /&gt;</code> <code>list</code> Action",id:"refine--list-action",level:3},{value:"Public Routes in refine",id:"public-routes-in-refine",level:3},{value:"<code>&lt;Refine /&gt;</code> <code>create</code> Action",id:"refine--create-action",level:3},{value:"<code>&lt;Refine /&gt;</code> <code>show</code> Action",id:"refine--show-action",level:2},{value:"Supabase Authentication with Refine",id:"supabase-authentication-with-refine",level:2},{value:"Email Authentication with Supabase in Refine",id:"email-authentication-with-supabase-in-refine",level:3},{value:"GitHub Authentication with Supabase in Refine",id:"github-authentication-with-supabase-in-refine",level:3},{value:"Implementing a Public Dashboard with Refine",id:"implementing-a-public-dashboard-with-refine",level:2},{value:"Summary",id:"summary",level:2}],c={toc:u};function m(e){var{components:t}=e,n=o(e,["components"]);return(0,a.kt)("wrapper",r(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){i(e,t,n[t])}))}return e}({},c,n),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"This post was created using version 3.x.x of ",(0,a.kt)("strong",{parentName:"p"},"refine"),". Although we plan to update it with the latest version of ",(0,a.kt)("strong",{parentName:"p"},"refine")," as soon as possible, you can still benefit from the post in the meantime."),(0,a.kt)("p",{parentName:"admonition"},"You should know that ",(0,a.kt)("strong",{parentName:"p"},"refine")," version 4.x.x is backward compatible with version 3.x.x, so there is no need to worry. If you want to see the differences between the two versions, check out the ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/migration-guide/"},"migration guide"),"."),(0,a.kt)("p",{parentName:"admonition"},"Just be aware that the source code examples in this post have been updated to version 4.x.x.")),(0,a.kt)("p",null,"In this post, we build on our existing understanding of ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/tutorial/understanding-dataprovider/index/"},(0,a.kt)("inlineCode",{parentName:"a"},"dataProvider"))," and ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/tutorial/understanding-authprovider/index/"},(0,a.kt)("inlineCode",{parentName:"a"},"authProvider"))," props of ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:3000/docs/api-reference/core/components/refine-config/"},(0,a.kt)("inlineCode",{parentName:"a"},"<Refine />"))," to implement CRUD operations in our ",(0,a.kt)("strong",{parentName:"p"},"Pixels")," app that we initialized in the previous post. While doing so, we discuss the roles of ",(0,a.kt)("inlineCode",{parentName:"p"},"<Refine />")," component's ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/tutorial/understanding-resources/index/"},(0,a.kt)("inlineCode",{parentName:"a"},"resources"))," and ",(0,a.kt)("inlineCode",{parentName:"p"},"routerProvider")," props as well."),(0,a.kt)("p",null,"CRUD actions are supported by the ",(0,a.kt)("a",{parentName:"p",href:"https://supabase.com/"},(0,a.kt)("strong",{parentName:"a"},"Supabase"))," data provider we chose for our project and in this post we use them to build a public gallery of canvases. We implement creation and displaying of individual canvases as well as drawing on them. We also add authentication features supported by the ",(0,a.kt)("inlineCode",{parentName:"p"},"supabaseClient")," we discussed on Day Two of the ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/week-of-refine/"},(0,a.kt)("strong",{parentName:"a"},"refineWeek"))," series."),(0,a.kt)("p",null,"This is Day Three and ",(0,a.kt)("strong",{parentName:"p"},"refineWeek")," is a seven-part tutorial that aims to help developers learn the ins-and-outs of ",(0,a.kt)("strong",{parentName:"p"},"refine"),"'s powerful capabilities and get going with ",(0,a.kt)("strong",{parentName:"p"},"refine")," within a week."),(0,a.kt)("h3",{id:"refineweek-series"},"refineWeek series"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Day 1 - ",(0,a.kt)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-1/"},"Pilot & refine architecture")),(0,a.kt)("li",{parentName:"ul"},"Day 2 - ",(0,a.kt)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-2/"},"Setting Up the Client App"))),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"In the last episode, we explored ",(0,a.kt)("strong",{parentName:"p"},"refine"),"'s auth and data providers in significant detail. We saw that ",(0,a.kt)("inlineCode",{parentName:"p"},"<Refine />"),"'s ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider")," props were set to support ",(0,a.kt)("a",{parentName:"p",href:"https://supabase.com/"},(0,a.kt)("strong",{parentName:"a"},"Supabase"))," thanks to the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/refinedev/refine/tree/master/packages/supabase"},(0,a.kt)("inlineCode",{parentName:"a"},"@refinedev/supabase"))," package."),(0,a.kt)("p",null,"We mentioned that ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider")," methods allow us to communicate with API endpoints and ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider")," methods help us with authentication and authorization. We are able to access and invoke these methods from consumer components via their corresponding hooks."),(0,a.kt)("p",null,"In this post, we will be leveraging ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider")," methods to implement CRUD operations for a ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," resource. We are going to start by adding ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," as a resource on which we will be able to perform ",(0,a.kt)("inlineCode",{parentName:"p"},"create"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," actions. We will first work on a public gallery that lists all canvases and a dashboard page that shows a selection of featured canvases by implementing the the ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," action. We will allow users to perform the canvas ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action from a modal. Then we will also implement the ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," action for a canvas."),(0,a.kt)("p",null,"We will then apply ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," auth provider to allow only logged in users to carry out ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," actions on ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"pixels"),". On the way, we will explore how ",(0,a.kt)("strong",{parentName:"p"},"refine")," does the heavylifting under the hood for us with ",(0,a.kt)("a",{parentName:"p",href:"https://react-query-v3.tanstack.com/"},(0,a.kt)("strong",{parentName:"a"},"React Query")),", and its own set of providers and hooks - making CRUD operations implementation a breeze."),(0,a.kt)("p",null,"But before we start, we have to set up ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," with our database tables and get the access credentials."),(0,a.kt)("h2",{id:"setting-up-supabase-for-refine"},"Setting Up Supabase for Refine"),(0,a.kt)("p",null,"For this app, we are using a PostgreSQL database for our backend. Our database will be hosted in the ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," cloud. In order to set up a PostgreSQL server, we need to sign up with ",(0,a.kt)("a",{parentName:"p",href:"https://app.supabase.com/"},(0,a.kt)("strong",{parentName:"a"},"Supabase"))," first."),(0,a.kt)("p",null,"After signing up and logging in to a developer account, we have to complete the following steps:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Create a PostgreSQL server with an appropriate name."),(0,a.kt)("li",{parentName:"ol"},"Create necessary tables in the database and add relationships."),(0,a.kt)("li",{parentName:"ol"},"Get API keys provided by ",(0,a.kt)("strong",{parentName:"li"},"Supabase")," for the server and set up ",(0,a.kt)("inlineCode",{parentName:"li"},"supabaseClient")," inside our ",(0,a.kt)("strong",{parentName:"li"},"refine")," project.")),(0,a.kt)("p",null,"Below, we go over these steps one by one."),(0,a.kt)("h3",{id:"1-creating-a-postgresql-server-with-supabase"},"1. Creating a PostgreSQL Server with Supabase"),(0,a.kt)("p",null,"Creating a database server is quite intutive in ",(0,a.kt)("strong",{parentName:"p"},"Supabase"),". Just go over to your organization's dashboard and start doing something. For me, I have initialized a server with the name ",(0,a.kt)("inlineCode",{parentName:"p"},"refine-pixels")," under a free tier. If you need a quick hand, please follow ",(0,a.kt)("a",{parentName:"p",href:"https://supabase.com/docs/guides/with-react#create-a-project"},"this quickstart guide"),"."),(0,a.kt)("h3",{id:"2-adding-tables-to-a-supabase-database"},"2. Adding Tables to a Supabase Database"),(0,a.kt)("p",null,"For our app, we have four tables: ",(0,a.kt)("inlineCode",{parentName:"p"},"auth.users"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"public.users"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"pixels"),". The entity relational diagram for our database looks like this:"),(0,a.kt)("div",{className:"centered-image"},(0,a.kt)("img",{style:{alignSelf:"center"},src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/supabase_Table.png",alt:"react crud app"})),(0,a.kt)("br",null),(0,a.kt)("br",null),(0,a.kt)("p",null,"We have a fifth, ",(0,a.kt)("inlineCode",{parentName:"p"},"logs")," table which we are going to use for audit logging with the ",(0,a.kt)("inlineCode",{parentName:"p"},"auditLogProvider")," on Day Seven. However, as we are progressing step by step, we are not concerned with that at the moment. We will be adding the ",(0,a.kt)("inlineCode",{parentName:"p"},"logs")," table on its day."),(0,a.kt)("p",null,"In order to add the above tables to your ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," database, please follow the below instructions:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.1 ",(0,a.kt)("inlineCode",{parentName:"strong"},"auth.users")," Table")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"auth.users")," table is concerned with authentication in our app. It is created by ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," as part of its authentication module, so we don't need to do anything about it."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Supabase")," supports a myriad of third party authentication providers as well as user input based email / password authentication. In our app, we'll implement GitHub authentication besides the email / password based option."),(0,a.kt)("br",null),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.2 ",(0,a.kt)("inlineCode",{parentName:"strong"},"public.users")," Table")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Supabase")," doesn't allow a client to query the ",(0,a.kt)("inlineCode",{parentName:"p"},"auth.users")," table for security reasons. So, we need to create a shadow of the ",(0,a.kt)("inlineCode",{parentName:"p"},"auth.users")," table in ",(0,a.kt)("inlineCode",{parentName:"p"},"public.users")," with additional columns. We need this shadow table to be able to query ",(0,a.kt)("inlineCode",{parentName:"p"},"user")," information, such as ",(0,a.kt)("inlineCode",{parentName:"p"},"avatar_url")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"roles")," from this table."),(0,a.kt)("div",{className:"centered-image"},(0,a.kt)("img",{style:{alignSelf:"center",width:"300px"},src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/sql_editor.png",alt:"react crud app"})),(0,a.kt)("br",null),(0,a.kt)("br",null),(0,a.kt)("p",null,"So, in order to create the ",(0,a.kt)("inlineCode",{parentName:"p"},"pubic.users")," table, go ahead and run this SQL script in the SQL Editor of your ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," project dashboard:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"-- Create a table for public users\ncreate table users (\n  id uuid references auth.users not null primary key,\n  updated_at timestamp with time zone,\n  username text unique,\n  full_name text,\n  avatar_url text\n);\n\n-- This trigger automatically creates a public.users entry when a new user signs up via Supabase Auth.\n-- See https://supabase.com/docs/guides/auth/managing-user-data#using-triggers for more details.\ncreate or replace function public.handle_new_public_user()\nreturns trigger as $$\nbegin\n  insert into public.users (id, full_name, avatar_url)\n  values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');\n  return new;\nend;\n$$ language plpgsql security definer;\ncreate trigger on_auth_user_created\n  after insert on auth.users\n  for each row execute procedure public.handle_new_public_user();\n\n-- Set up Storage!\ninsert into storage.buckets (id, name)\n  values ('avatars', 'avatars');\n\n-- Set up access controls for storage.\n-- See https://supabase.com/docs/guides/storage#policy-examples for more details.\ncreate policy \"Avatar images are publicly accessible.\" on storage.objects\n  for select using (bucket_id = 'avatars');\n\ncreate policy \"Anyone can upload an avatar.\" on storage.objects\n  for insert with check (bucket_id = 'avatars');\n")),(0,a.kt)("br",null),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.3 ",(0,a.kt)("inlineCode",{parentName:"strong"},"canvases")," Table")),(0,a.kt)("p",null,"For the ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," table, run this SQL script inside the ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," SQL Editor:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"create table canvases (\n  id text unique primary key not null,\n  user_id uuid references users on delete cascade not null,\n  name text not null,\n  width int8 not null,\n  height int8 not null,\n  is_featured boolean default false not null,\n\n  created_at timestamp with time zone default timezone('utc'::text, now()) not null,\n  updated_at timestamp with time zone default timezone('utc'::text, now()) not null\n);\n")),(0,a.kt)("br",null),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.4 ",(0,a.kt)("inlineCode",{parentName:"strong"},"pixels")," Table")),(0,a.kt)("p",null,"For the ",(0,a.kt)("inlineCode",{parentName:"p"},"pixels")," table run the following SQL script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"create table pixels (\n  id int8 generated by default as identity primary key not null,\n  user_id uuid references users on delete cascade not null,\n  canvas_id text references canvases on delete cascade not null,\n  x int8 not null,\n  y int8 not null,\n  color text not null,\n\n  created_at timestamp with time zone default timezone('utc'::text, now()) not null\n);\n")),(0,a.kt)("p",null,"If you want to create the tables using Table Editor from the dashboard, feel free to use ",(0,a.kt)("a",{parentName:"p",href:"https://supabase.com/docs/guides/database/tables#creating-tables"},"the Supabase docs"),"."),(0,a.kt)("br",null),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.5 Relationship Between Tables")),(0,a.kt)("p",null,"If we look closely, ",(0,a.kt)("inlineCode",{parentName:"p"},"public.users")," table has a ",(0,a.kt)("strong",{parentName:"p"},"one-to-many")," relationship with ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," and a ",(0,a.kt)("inlineCode",{parentName:"p"},"canvas")," must belong to a ",(0,a.kt)("inlineCode",{parentName:"p"},"user"),"."),(0,a.kt)("p",null,"Similarly ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," also has a one-to-many relationship with ",(0,a.kt)("inlineCode",{parentName:"p"},"pixels"),". A ",(0,a.kt)("inlineCode",{parentName:"p"},"canvas")," has many ",(0,a.kt)("inlineCode",{parentName:"p"},"pixels")," and a ",(0,a.kt)("inlineCode",{parentName:"p"},"pixel")," must belong to a ",(0,a.kt)("inlineCode",{parentName:"p"},"canvas"),"."),(0,a.kt)("p",null,"Also, ",(0,a.kt)("inlineCode",{parentName:"p"},"public.users")," has a one-to-many relationship with ",(0,a.kt)("inlineCode",{parentName:"p"},"pixels"),"."),(0,a.kt)("br",null),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.5 Disable RLS")),(0,a.kt)("p",null,"For simplicity, we'll disable Row Level Security:"),(0,a.kt)("div",{className:"centered-image"},(0,a.kt)("img",{style:{alignSelf:"center",width:"600px"},src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/disable_rls.png",alt:"react crud app supabase"})),(0,a.kt)("br",null),(0,a.kt)("h3",{id:"3-set-up-supabaseclient-for-refine--providers"},"3. Set Up ",(0,a.kt)("inlineCode",{parentName:"h3"},"supabaseClient")," for ",(0,a.kt)("inlineCode",{parentName:"h3"},"<Refine />")," Providers"),(0,a.kt)("p",null,"Now it's time to use the ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," hosted database server inside our ",(0,a.kt)("strong",{parentName:"p"},"refine")," app."),(0,a.kt)("p",null,"First, we need to get the access credentials for our server from the ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," dashboard. We can avail them by following ",(0,a.kt)("a",{parentName:"p",href:"https://supabase.com/docs/guides/with-react#get-the-api-keys"},"this section")," in the ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," quickstart guide."),(0,a.kt)("p",null,"I recommend storing these credentials in a ",(0,a.kt)("inlineCode",{parentName:"p"},".env")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=".env"',title:'".env"'},"SUPABASE_URL=YOUR_SUPABASE_URL\nSUPABASE_KEY=YOUR_SUPABASE_KEY\n")),(0,a.kt)("p",null,"Doing so will let us use these credentials to update the ",(0,a.kt)("inlineCode",{parentName:"p"},"supabaseClient.ts")," file created by ",(0,a.kt)("inlineCode",{parentName:"p"},"refine ")," at initialization:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="supabaseClient.ts"',title:'"supabaseClient.ts"'},'import { createClient } from "@refinedev/supabase";\n\nconst SUPABASE_URL = process.env.SUPABASE_URL ?? "";\nconst SUPABASE_KEY = process.env.SUPABASE_KEY ?? "";\n\nexport const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);\n')),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"<Refine />")," component's ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"liveProvider")," objects utilize this ",(0,a.kt)("inlineCode",{parentName:"p"},"supabaseClient")," to connect to the PostgreSQL server hosted on ",(0,a.kt)("strong",{parentName:"p"},"Supabase"),"."),(0,a.kt)("p",null,"With this set up, now we can introduce ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," resource and start implementing CRUD operations for our app so that we can perform queries on the ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," table."),(0,a.kt)("h2",{id:"refine-s-resources-prop"},(0,a.kt)("inlineCode",{parentName:"h2"},"<Refine />"),"'s ",(0,a.kt)("inlineCode",{parentName:"h2"},"resources")," Prop"),(0,a.kt)("p",null,"If we look at our initial ",(0,a.kt)("inlineCode",{parentName:"p"},"App.tsx")," component, it looks like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'},'import React from "react";\nimport { Refine } from "@refinedev/core";\nimport {\n  AuthPage,\n  notificationProvider,\n  ReadyPage,\n  ErrorComponent,\n} from "@refinedev/antd";\n\nimport { dataProvider, liveProvider } from "@refinedev/supabase";\nimport routerProvider from "@refinedev/react-router-v6";\nimport { supabaseClient } from "utility";\nimport authProvider from "./authProvider";\n\nfunction App() {\n  return (\n    <Refine\n      dataProvider={dataProvider(supabaseClient)}\n      liveProvider={liveProvider(supabaseClient)}\n      authProvider={authProvider}\n      routerProvider={{\n        ...routerProvider,\n        routes: [\n          {\n            path: "/register",\n            element: <AuthPage type="register" />,\n          },\n          {\n            path: "/forgot-password",\n            element: <AuthPage type="forgotPassword" />,\n          },\n          {\n            path: "/update-password",\n            element: <AuthPage type="updatePassword" />,\n          },\n        ],\n      }}\n      LoginPage={() => (\n        <AuthPage\n          type="login"\n          providers={[\n            {\n              name: "google",\n              label: "Sign in with Google",\n            },\n          ]}\n        />\n      )}\n      notificationProvider={notificationProvider}\n      ReadyPage={ReadyPage}\n      catchAll={<ErrorComponent />}\n      Layout={Layout}\n    />\n  );\n}\n\nexport default App;\n')),(0,a.kt)("p",null,"Focusing on the top, in order to add a resource to our app, we have to introduce the  ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/tutorial/understanding-resources/index/"},(0,a.kt)("inlineCode",{parentName:"a"},"resources"))," prop to ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:3000/docs/api-reference/core/components/refine-config/"},(0,a.kt)("inlineCode",{parentName:"a"},"<Refine />")),". The value of ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," prop should be an ",(0,a.kt)("strong",{parentName:"p"},"array")," of resource items with RESTful routes in our app. A typical resource object contains properties and values related to the resource ",(0,a.kt)("inlineCode",{parentName:"p"},"name"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"options"),", and intended actions:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="Typical resource object inside resources array"',title:'"Typical',resource:!0,object:!0,inside:!0,resources:!0,'array"':!0},'{\n  name: "canvases",\n  options: {\n    label: "Canvases",\n  },\n  list: CanvasList,\n  show: CanvasShow,\n}\n')),(0,a.kt)("p",null,"We can have as many resource items inside our ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," array as the number of entities we have in our app."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"refine")," simplifies CRUD actions and routing related to all items in the ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," array. It's worth spending a few minutes exploring the possible properties of a resource item from ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/components/refine-config/#resources"},"the ",(0,a.kt)("inlineCode",{parentName:"a"},"resources")," docs here"),"."),(0,a.kt)("p",null,"For the above ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," resource, the ",(0,a.kt)("inlineCode",{parentName:"p"},"name")," property denotes the name of the resource. Behind the scenes, ",(0,a.kt)("strong",{parentName:"p"},"refine")," auto-magically adds RESTful routes for the actions defined on a resource ",(0,a.kt)("inlineCode",{parentName:"p"},"name")," to the ",(0,a.kt)("inlineCode",{parentName:"p"},"routerProvider")," object - i.e. for us here along the ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases")," path."),(0,a.kt)("p",null,"We'll ignore the ",(0,a.kt)("inlineCode",{parentName:"p"},"options")," object for now, but ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," properties represent the CRUD actions we want. And their values are the components we want to render when we navigate to their respective RESTful routes, such as ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases/show/a-canvas-slug"),". Once again, ",(0,a.kt)("strong",{parentName:"p"},"refine")," generates these routes, places them into the ",(0,a.kt)("inlineCode",{parentName:"p"},"routerProvider")," object. It then matches them to their corresponding components when these routes are visited."),(0,a.kt)("p",null,"We will use a modal form for the ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action, so we don't need ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases/create")," route. Therefore, we won't assign ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," property for ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," resource."),(0,a.kt)("h3",{id:"adding-resources-to-refine-"},"Adding ",(0,a.kt)("inlineCode",{parentName:"h3"},"resources")," to ",(0,a.kt)("inlineCode",{parentName:"h3"},"<Refine />")),(0,a.kt)("p",null,"For our app, we'll configure our ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," object with actions for ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases"),". So, let's add ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," resource with ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," actions:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'},'<Refine\n   ...\n  //highlight-start\n  resources={[\n    {\n      name: "canvases",\n      option: {\n        label: "Canvases",\n      },\n      list: CanvasList,\n      show: CanvasShow,\n    },\n  ]};\n  //highlight-end\n/>\n')),(0,a.kt)("p",null,"We will consider these two actions with their respective components in the coming sections. We should have the ",(0,a.kt)("inlineCode",{parentName:"p"},"CanvasList")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"CanvasShow")," components premade. In a ",(0,a.kt)("strong",{parentName:"p"},"refine")," app, CRUD action related components are typically placed in a directory that has a structure like this: ",(0,a.kt)("inlineCode",{parentName:"p"},"src/pages/resource_name/"),"."),(0,a.kt)("p",null,"In our case, we'll house ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," related components in the ",(0,a.kt)("inlineCode",{parentName:"p"},"src/pages/canvases/")," folder."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"strong"},"index")," Files")),(0,a.kt)("p",null,"We are also using ",(0,a.kt)("inlineCode",{parentName:"p"},"index.ts")," files to export contents from our folders, so that the components are easily found by the compiler in the global namespace."),(0,a.kt)("h3",{id:"adding-required-files"},"Adding required files"),(0,a.kt)("p",null,"Here is the finalized version of what we'll be building in this article:\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/refinedev/refine/tree/master/examples/pixels"},"https://github.com/refinedev/refine/tree/master/examples/pixels")),(0,a.kt)("p",null,"Before we move on, you need to add required page and components to the project if you want build the app by following the article. Please add the following components and files into ",(0,a.kt)("inlineCode",{parentName:"p"},"src")," folder in the project:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"pages: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/refinedev/refine/tree/master/examples/pixels/src/pages"},"https://github.com/refinedev/refine/tree/master/examples/pixels/src/pages")),(0,a.kt)("li",{parentName:"ul"},"components: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/refinedev/refine/tree/master/examples/pixels/src/components"},"https://github.com/refinedev/refine/tree/master/examples/pixels/src/components")),(0,a.kt)("li",{parentName:"ul"},"utility: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/refinedev/refine/tree/master/examples/pixels/src/utility"},"https://github.com/refinedev/refine/tree/master/examples/pixels/src/utility")),(0,a.kt)("li",{parentName:"ul"},"types: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/refinedev/refine/tree/master/examples/pixels/src/types"},"https://github.com/refinedev/refine/tree/master/examples/pixels/src/types")),(0,a.kt)("li",{parentName:"ul"},"styles: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/refinedev/refine/tree/master/examples/pixels/src/styles"},"https://github.com/refinedev/refine/tree/master/examples/pixels/src/styles"))),(0,a.kt)("p",null,"After creating files above you need to add some imports to ",(0,a.kt)("inlineCode",{parentName:"p"},"App.tsx"),", simply add replace  your ",(0,a.kt)("inlineCode",{parentName:"p"},"App.tsx")," with following."),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Show App.tsx code"),(0,a.kt)("p",null,(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'},"import React from 'react';\nimport { Refine } from '@refinedev/core';\nimport {\n    AuthPage,\n    notificationProvider,\n    ReadyPage,\n    ErrorComponent,\n    Icons\n} from '@refinedev/antd';\nimport '@refinedev/antd/dist/reset.css';\nimport { dataProvider, liveProvider } from '@refinedev/supabase';\nimport routerProvider from '@refinedev/react-router-v6';\n\nimport { supabaseClient } from 'utility';\nimport authProvider from './authProvider';\nimport { Layout } from 'components/layout';\nimport { CanvasFeaturedList, CanvasList, CanvasShow } from 'pages/canvases';\nimport 'styles/style.css';\n\nconst { GithubOutlined } = Icons;\n\nfunction App() {\n    return (\n        <Refine\n            dataProvider={dataProvider(supabaseClient)}\n            liveProvider={liveProvider(supabaseClient)}\n            authProvider={authProvider}\n            routerProvider={{\n                ...routerProvider,\n                routes: [\n                    {\n                        path: '/register',\n                        element: <AuthPage type=\"register\" />,\n                    },\n                    {\n                        path: '/forgot-password',\n                        element: <AuthPage type=\"forgotPassword\" />,\n                    },\n                    {\n                        path: '/update-password',\n                        element: <AuthPage type=\"updatePassword\" />,\n                    },\n                ],\n            }}\n            LoginPage={() => (\n                <AuthPage\n                    type=\"login\"\n                    providers={[\n                        {\n                            name: 'github',\n                            icon: (\n                                    <GithubOutlined\n                                      style={{ fontSize: \"18px\" }}\n                                    />\n                                    ),\n                            label: 'Sign in with GitHub',\n                        },\n                    ]}\n                />\n            )}\n            resources={[\n                {\n                    name: 'canvases',\n                    options: {\n                        label: 'Canvases',\n                    },\n                    list: CanvasList,\n                    show: CanvasShow,\n                },\n            ]}\n            notificationProvider={notificationProvider}\n            ReadyPage={ReadyPage}\n            catchAll={<ErrorComponent />}\n            Layout={Layout}\n        />\n    );\n}\n\nexport default App;\n")))),(0,a.kt)("h3",{id:"refine--list-action"},(0,a.kt)("inlineCode",{parentName:"h3"},"<Refine />")," ",(0,a.kt)("inlineCode",{parentName:"h3"},"list")," Action"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," action represents a ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," request sent to the ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," table in our ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," db. It is done through the ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider.getList")," method that ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/refinedev/refine/blob/master/packages/supabase/src/index.ts"},(0,a.kt)("inlineCode",{parentName:"a"},"@refinedev/supabase"))," gave us. From the consumer ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasList />")," component, it can be accessed via the ",(0,a.kt)("inlineCode",{parentName:"p"},"useList()")," hook."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"refine")," defines the routes for ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," action to be the ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases")," path, and adds it to the ",(0,a.kt)("inlineCode",{parentName:"p"},"routerProvider")," object. ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases")," path, in turn, renders the ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasList />")," component, as specified in the ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," array."),(0,a.kt)("p",null,"The contents of our ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasList />")," component look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/canvases/list.tsx"',title:'"src/pages/canvases/list.tsx"'},'import { AntdList, Skeleton, useSimpleList } from "@refinedev/antd";\n\nimport { CanvasTile } from "components/canvas";\nimport { SponsorsBanner } from "components/banners";\nimport { Canvas } from "types";\n\nexport const CanvasList: React.FC = () => {\n    const { listProps, queryResult } = useSimpleList<Canvas>({\n        resource: "canvases",\n        pagination: {\n            pageSize: 12,\n        },\n        sorters: {\n            initial: [\n                {\n                    field: "created_at",\n                    order: "desc",\n                },\n            ],\n        }\n    });\n\n    const { isLoading } = queryResult;\n\n    return (\n        <div className="container">\n            <div className="paper">\n                {isLoading ? (\n                    <div className="canvas-skeleton-list">\n                        {[...Array(12)].map((_, index) => (\n                            <Skeleton key={index} paragraph={{ rows: 8 }} />\n                        ))}\n                    </div>\n                ) : (\n                    <AntdList\n                        {...listProps}\n                        className="canvas-list"\n                        split={false}\n                        renderItem={(canvas) => <CanvasTile canvas={canvas} />}\n                    />\n                )}\n            </div>\n            <SponsorsBanner />\n        </div>\n    );\n};\n')),(0,a.kt)("p",null,"There are a few of things to note here: the first being the use of ",(0,a.kt)("strong",{parentName:"p"},"Ant Design")," with ",(0,a.kt)("strong",{parentName:"p"},"refine"),"'s ",(0,a.kt)("inlineCode",{parentName:"p"},"@refinedev/antd")," module. The second thing is the ",(0,a.kt)("inlineCode",{parentName:"p"},"useSimpleList()")," hook that is being used to access ",(0,a.kt)("inlineCode",{parentName:"p"},"listProps")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"queryResult")," items to feed UI elements. And third, the use of pagination and sorting in the query sent."),(0,a.kt)("p",null,"Let's briefly discuss what's going on:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"1. ",(0,a.kt)("inlineCode",{parentName:"strong"},"refine-antd")," Components")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"refine")," makes all ",(0,a.kt)("strong",{parentName:"p"},"Ant Design")," components available to us via the ",(0,a.kt)("inlineCode",{parentName:"p"},"@refinedev/antd")," package. They can be used with their same name in ",(0,a.kt)("strong",{parentName:"p"},"Ant Design"),". However, ",(0,a.kt)("strong",{parentName:"p"},"Ant Design"),"'s ",(0,a.kt)("inlineCode",{parentName:"p"},"<List />")," component is renamed as ",(0,a.kt)("inlineCode",{parentName:"p"},"<AntdList />"),", which we are using above."),(0,a.kt)("p",null,"It takes in the props inside ",(0,a.kt)("inlineCode",{parentName:"p"},"listProps")," object that ",(0,a.kt)("inlineCode",{parentName:"p"},"useSimpleList()")," hook prepares for us from the fetched canvases array and shows each canvas data inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasTile />")," component. All the props and presentation logic are being handled inside the ",(0,a.kt)("strong",{parentName:"p"},"Ant Design")," ",(0,a.kt)("inlineCode",{parentName:"p"},"<List />")," component. For detailed info on the ",(0,a.kt)("inlineCode",{parentName:"p"},"<List />")," component, please visit ",(0,a.kt)("a",{parentName:"p",href:"https://ant.design/components/list#list"},"this ",(0,a.kt)("strong",{parentName:"a"},"Ant Design")," reference.")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/tutorial/introduction/select-framework/"},"Refer to complete refine CRUD app with Ant Design tutorial here.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2. ",(0,a.kt)("inlineCode",{parentName:"strong"},"useSimpleList()")," Hook")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"useSimpleList()")," is a ",(0,a.kt)("inlineCode",{parentName:"p"},"@refinedev/antd")," hook built on top of the low level ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/hooks/data/useList/"},(0,a.kt)("inlineCode",{parentName:"a"},"useList()"))," hook to fetch a resource collection. After fetching data according to the the value of the ",(0,a.kt)("inlineCode",{parentName:"p"},"resource")," property, it prepares it according to the ",(0,a.kt)("inlineCode",{parentName:"p"},"listProps")," of the ",(0,a.kt)("strong",{parentName:"p"},"Ant Design"),"'s ",(0,a.kt)("inlineCode",{parentName:"p"},"<List />")," component. "),(0,a.kt)("p",null,"In our ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasList />")," component, we are passing the ",(0,a.kt)("inlineCode",{parentName:"p"},"listProps")," props to ",(0,a.kt)("inlineCode",{parentName:"p"},"<AntdList />")," in order to show a list of canvases."),(0,a.kt)("p",null,"Please feel free to go through the ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/antd/hooks/list/useSimpleList/"},(0,a.kt)("inlineCode",{parentName:"a"},"useSimpleList")," documentation here")," for as much as information as you need. It makes life a lot easier while creating a dashboard or list of items."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"3. Sorting"),"\nIf you are already looking at the ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/antd/hooks/list/useSimpleList/#properties"},(0,a.kt)("inlineCode",{parentName:"a"},"useSimpleList()")," argument object's properties"),", notice that we are able to pass options for ",(0,a.kt)("inlineCode",{parentName:"p"},"pagination")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sorters.initial")," for the API call and get the response accordingly."),(0,a.kt)("p",null,"With this set up - and connected to the Internet - if we run the dev server with ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn dev")," and navigate to ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:3000"),", we are faced with a login screen:"),(0,a.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/login.png",alt:"react crud app supabase"}),(0,a.kt)("br",null),(0,a.kt)("p",null,"Well... That's mean!"),(0,a.kt)("p",null,"Okay, this is because we have ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider")," prop activated in the boilerplate ",(0,a.kt)("inlineCode",{parentName:"p"},"<App />")," component. Additionally, the ",(0,a.kt)("inlineCode",{parentName:"p"},"LoginPage")," prop was also set to ",(0,a.kt)("strong",{parentName:"p"},"refine"),"'s special ",(0,a.kt)("inlineCode",{parentName:"p"},"<AuthPage />")," component. Because of this, we are being presented with the ",(0,a.kt)("inlineCode",{parentName:"p"},"<AuthPage />")," component's login ",(0,a.kt)("inlineCode",{parentName:"p"},"type")," variant which basically wants us to authenticate before we move forward.  "),(0,a.kt)("p",null,"Also you can inspect the ",(0,a.kt)("inlineCode",{parentName:"p"},"pages/auth/index.tsx")," component to see how we customized the default Auth Page component."),(0,a.kt)("p",null,"However, we want our gallery at ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases")," to be public. So we need to bypass authentication for this path. And we can do that by tweaking the ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider.checkAuth()")," method."),(0,a.kt)("p",null,"Let's look at its current implementation and discussn the whats and hows before we come up with the changes."),(0,a.kt)("h3",{id:"public-routes-in-refine"},"Public Routes in refine"),(0,a.kt)("p",null,"If we revisit the ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider")," object, we can see that the ",(0,a.kt)("inlineCode",{parentName:"p"},"checkAuth()")," method only allows logged in users into the root route. All other attempts are rejected:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/authProvider.ts"',title:'"src/authProvider.ts"'},"checkAuth: async () => {\n  const session = supabaseClient.auth.session();\n  const sessionFromURL = await supabaseClient.auth.getSessionFromUrl();\n\n  if (session || sessionFromURL?.data?.user) {\n    return Promise.resolve();\n  }\n\n  return Promise.reject();\n},\n")),(0,a.kt)("p",null,"We'll change this to be the opposite. To check for the session from the current ",(0,a.kt)("inlineCode",{parentName:"p"},"url")," and allow all users to ",(0,a.kt)("inlineCode",{parentName:"p"},"/"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/authProvider.ts"',title:'"src/authProvider.ts"'},"checkAuth: async () => {\n  await supabaseClient.auth.getSessionFromUrl();\n  return Promise.resolve();\n},\n")),(0,a.kt)("p",null,"We'll modify the ",(0,a.kt)("inlineCode",{parentName:"p"},"getUserIdentity()")," method as well, because we are using it in the ",(0,a.kt)("inlineCode",{parentName:"p"},"<Header />")," component which houses a button for creating a canvas:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/authProvider.ts"',title:'"src/authProvider.ts"'},"getUserIdentity: async () => {\n  const user = supabaseClient.auth.user();\n\n  if (user) {\n    return Promise.resolve({\n      ...user,\n      name: user.email,\n    });\n  }\n\n  return Promise.reject();\n},\n")),(0,a.kt)("p",null,"Now, if we refresh our browser at ",(0,a.kt)("inlineCode",{parentName:"p"},"/"),", we see it redirected to ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases"),". This is because when the ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," object is set, ",(0,a.kt)("strong",{parentName:"p"},"refine")," configures the root route to be the ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," action of the ",(0,a.kt)("strong",{parentName:"p"},"first")," resource item in the ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," array. Since we only have ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," as our resource, it leads to ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases"),"."),(0,a.kt)("p",null,"At the moment, we don't have any ",(0,a.kt)("inlineCode",{parentName:"p"},"canvas")," created in our app yet, so at ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases")," we don't see the gallery:"),(0,a.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/empty_canvas.png",alt:"react crud app supabase"}),(0,a.kt)("br",null),(0,a.kt)("p",null,"The change in ",(0,a.kt)("inlineCode",{parentName:"p"},"checkAuth")," brings caveats, as removing the ",(0,a.kt)("inlineCode",{parentName:"p"},"return Promise.reject()")," disables the ",(0,a.kt)("inlineCode",{parentName:"p"},"LoginPage")," prop of ",(0,a.kt)("inlineCode",{parentName:"p"},"<Refine />"),", so with this change we will get a ",(0,a.kt)("inlineCode",{parentName:"p"},"404")," error when we visit ",(0,a.kt)("inlineCode",{parentName:"p"},"/login"),". We'll come back to this in the section related to Authentication."),(0,a.kt)("p",null,"But, let's now go ahead and implement how to create canvases."),(0,a.kt)("h3",{id:"refine--create-action"},(0,a.kt)("inlineCode",{parentName:"h3"},"<Refine />")," ",(0,a.kt)("inlineCode",{parentName:"h3"},"create")," Action"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action represents a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," request sent to the ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," table in our ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," database. It is done with the ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider.create()")," method that ",(0,a.kt)("inlineCode",{parentName:"p"},"@refinedev/supabase")," package gave us."),(0,a.kt)("p",null,"We are presenting the canvas form inside a modal contained in a ",(0,a.kt)("inlineCode",{parentName:"p"},"<CreateCanvas />")," component, which is placed in the ",(0,a.kt)("inlineCode",{parentName:"p"},"<Header />")," component. And the modal is accessed with a ",(0,a.kt)("inlineCode",{parentName:"p"},"Create")," canvas button we have in the ",(0,a.kt)("inlineCode",{parentName:"p"},"<Header />"),"."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"<Header />")," component looks like this:"),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Show Header component code"),(0,a.kt)("p",null,(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/components/layout/header/index.tsx"',title:'"src/components/layout/header/index.tsx"'},'import React from "react";\nimport {\n    useGetIdentity,\n    useLogout,\n    useMenu,\n    useNavigation,\n    useRouterContext,\n} from "@refinedev/core";\nimport { Button, Image, Space, Icons, useModalForm } from "@refinedev/antd";\n\nimport { CreateCanvas } from "components/canvas";\nimport { Canvas } from "types";\n\nconst { PlusSquareOutlined, LogoutOutlined, LoginOutlined } = Icons;\n\nexport const Header: React.FC = () => {\n    const { Link, useLocation } = useRouterContext();\n    const { isError } = useGetIdentity();\n    const { mutate: mutateLogout } = useLogout();\n    const { push } = useNavigation();\n    const { selectedKey } = useMenu();\n    const { pathname } = useLocation();\n\n    const { modalProps, formProps, show } = useModalForm<Canvas>({\n        resource: "canvases",\n        action: "create",\n        redirect: "show",\n    });\n\n    const isLogin = !isError;\n\n    const handleRedirect = () => {\n        if (pathname === "/") {\n            push("/login");\n        }\n\n        push(`/login?to=${encodeURIComponent(pathname)}`);\n    };\n\n    return (\n        <div className="container">\n            <div className="layout-header">\n                <Link to="/">\n                    <Image\n                        width="120px"\n                        src="/pixels-logo.svg"\n                        alt="Pixels Logo"\n                        preview={false}\n                    />\n                </Link>\n                <Space size="large">\n                    <Link\n                        to="/"\n                        className={`nav-button ${\n                            selectedKey === "/" ? "active" : ""\n                        }`}\n                    >\n                        <span className="dot-icon" />\n                        HOME\n                    </Link>\n                    <Link\n                        to="/canvases"\n                        className={`nav-button ${\n                            selectedKey === "/canvases" ? "active" : ""\n                        }`}\n                    >\n                        <span className="dot-icon" />\n                        NEW\n                    </Link>\n                </Space>\n                <Space>\n                    <Button\n                        icon={<PlusSquareOutlined />}\n                        onClick={() => {\n                            if (isLogin) {\n                                show();\n                            } else {\n                                handleRedirect();\n                            }\n                        }}\n                        title="Create a new canvas"\n                    >\n                        Create\n                    </Button>\n                    {isLogin ? (\n                        <Button\n                            type="primary"\n                            danger\n                            onClick={() => {\n                                mutateLogout();\n                            }}\n                            icon={<LogoutOutlined />}\n                            title="Logout"\n                        />\n                    ) : (\n                        <Button\n                            type="primary"\n                            onClick={() => {\n                                handleRedirect();\n                            }}\n                            icon={<LoginOutlined />}\n                            title="Login"\n                        >\n                            Login\n                        </Button>\n                    )}\n                </Space>\n            </div>\n            <CreateCanvas modalProps={modalProps} formProps={formProps} />\n        </div>\n    );\n};\n')))),(0,a.kt)("p",null,"Our ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action involves the ",(0,a.kt)("inlineCode",{parentName:"p"},"useModalForm()")," hook which manages UI, state, error and data fetching for the ",(0,a.kt)("inlineCode",{parentName:"p"},"refine-antd")," ",(0,a.kt)("inlineCode",{parentName:"p"},"<Modal />")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"<Form />")," components. Let's zoom in on what exactly it is doing."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"The ",(0,a.kt)("inlineCode",{parentName:"strong"},"useModalForm()")," Hook")),(0,a.kt)("p",null,"In the ",(0,a.kt)("inlineCode",{parentName:"p"},"<Header />")," component above, we are invoking the ",(0,a.kt)("inlineCode",{parentName:"p"},"useModalForm()")," hook with its argument object containing ",(0,a.kt)("inlineCode",{parentName:"p"},"resource"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"action")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"redirect")," properties. We are getting the ",(0,a.kt)("inlineCode",{parentName:"p"},"modalProps")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"formProps")," properties that it prepares for us from the response data.  "),(0,a.kt)("p",null,"There are loads of things happening here. So I recommend going through the ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/antd/hooks/form/useModalForm/"},(0,a.kt)("inlineCode",{parentName:"a"},"useModalForm()")," documentation"),"."),(0,a.kt)("p",null,"It is also important that we understand how the ",(0,a.kt)("strong",{parentName:"p"},"Ant Design")," ",(0,a.kt)("inlineCode",{parentName:"p"},"<Modal />")," component accepts the ",(0,a.kt)("inlineCode",{parentName:"p"},"modalProps")," props from ",(0,a.kt)("a",{parentName:"p",href:"https://ant.design/components/modal#api"},"this page")," and how the ",(0,a.kt)("inlineCode",{parentName:"p"},"<Form />")," works with ",(0,a.kt)("inlineCode",{parentName:"p"},"formProps")," from ",(0,a.kt)("a",{parentName:"p",href:"https://ant.design/components/form#api"},"here"),"."),(0,a.kt)("p",null,"We are using the ",(0,a.kt)("inlineCode",{parentName:"p"},"<Modal />")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"<Form />")," inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"<CreateCanvas />")," component that receives the ",(0,a.kt)("inlineCode",{parentName:"p"},"modalProps")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"formProps")," and relays them to these descendents:"),(0,a.kt)("details",null,(0,a.kt)("summary",null,"CreateCanvas component code"),(0,a.kt)("p",null,(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/components/canvas/create.tsx"',title:'"src/components/canvas/create.tsx"'},'import React, { useState } from "react";\nimport { useGetIdentity } from "@refinedev/core";\nimport {\n    Form,\n    FormProps,\n    Input,\n    Modal,\n    ModalProps,\n    Radio,\n} from "@refinedev/antd";\n\nimport { getRandomName, DEFAULT_CANVAS_SIZE } from "utility";\n\ntype CreateCanvasProps = {\n    modalProps: ModalProps;\n    formProps: FormProps;\n};\n\nexport const CreateCanvas: React.FC<CreateCanvasProps> = ({\n    modalProps,\n    formProps,\n}) => {\n    const { data: user } = useGetIdentity();\n\n    const [values, setValues] = useState(() => {\n        const name = getRandomName();\n        return {\n            name: name,\n            id: name.replace(/\\s/g, "-").toLowerCase(),\n            width: DEFAULT_CANVAS_SIZE,\n            height: DEFAULT_CANVAS_SIZE,\n        };\n    });\n\n    return (\n        <Modal\n            {...modalProps}\n            title="Create Canvas"\n            width={600}\n            centered\n            afterClose={() => {\n                const name = getRandomName();\n                setValues({\n                    name: name,\n                    id: name.replace(/\\s/g, "-").toLowerCase(),\n                    width: DEFAULT_CANVAS_SIZE,\n                    height: DEFAULT_CANVAS_SIZE,\n                });\n            }}\n            bodyStyle={{ borderRadius: "6px" }}\n        >\n            <Form\n                {...formProps}\n                labelCol={{ span: 6 }}\n                wrapperCol={{ span: 12 }}\n                onFinish={() => {\n                    return (\n                        formProps.onFinish &&\n                        formProps.onFinish({\n                            ...values,\n                            user_id: user?.id,\n                        })\n                    );\n                }}\n            >\n                <Form.Item label="ID:">\n                    <Input value={values.id} disabled />\n                </Form.Item>\n\n                <Form.Item label="Name:">\n                    <Input value={values.name} disabled />\n                </Form.Item>\n\n                <Form.Item label="Size:">\n                    <Radio.Group\n                        options={[10, 20, 30]}\n                        onChange={({ target: { value } }) =>\n                            setValues((p) => ({\n                                ...p,\n                                height: value,\n                                width: value,\n                            }))\n                        }\n                        value={values.width}\n                        optionType="button"\n                        buttonStyle="solid"\n                    />\n                </Form.Item>\n            </Form>\n        </Modal>\n    );\n};\n')))),(0,a.kt)("p",null,"Notice the use of the ",(0,a.kt)("inlineCode",{parentName:"p"},"formProps.onFinish()")," method on ",(0,a.kt)("inlineCode",{parentName:"p"},"<Form />"),"'s ",(0,a.kt)("inlineCode",{parentName:"p"},"onFinish")," prop. This is the form event which initiates the ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action."),(0,a.kt)("p",null,"Behind the scenes, ",(0,a.kt)("inlineCode",{parentName:"p"},"useModalForm()")," ultimately calls the ",(0,a.kt)("inlineCode",{parentName:"p"},"useCreate()")," data hook which fetches the data with the ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider.create()")," method."),(0,a.kt)("p",null,"For details about how the ",(0,a.kt)("inlineCode",{parentName:"p"},"useCreate()")," hook works, please refer to ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/hooks/data/useCreate/"},"this ",(0,a.kt)("strong",{parentName:"a"},"refine")," documentation"),"."),(0,a.kt)("p",null,"Notice also that we are passing the ",(0,a.kt)("inlineCode",{parentName:"p"},"redirect")," property to the ",(0,a.kt)("inlineCode",{parentName:"p"},"useModalForm()")," hook which specifies that we redirect to the ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," action of the resource. We'll come to this in the next section related to adding ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," action in our ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," resource."),(0,a.kt)("p",null,"If we now click on the ",(0,a.kt)("inlineCode",{parentName:"p"},"Create")," button in our navbar, we will be again redirected to the ",(0,a.kt)("inlineCode",{parentName:"p"},"/login")," page."),(0,a.kt)("p",null,"This is because for the ",(0,a.kt)("inlineCode",{parentName:"p"},"onClick")," event on the ",(0,a.kt)("inlineCode",{parentName:"p"},"Create")," canvas button inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"<Header />")," component, we have asked the router to authenticate the user if they are not logged in:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/components/layout/header/index.tsx"',title:'"src/components/layout/header/index.tsx"'},'<Button\n  icon={<PlusSquareOutlined />}\n  onClick={() => {\n    if (isLogin) {\n      show();\n    } else {\n      handleRedirect();\n    }\n  }}\n  title="Create a new canvas"\n>\n  Create\n</Button>\n')),(0,a.kt)("p",null,"And because of the change we made in ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider.checkAuth()"),", we get a ",(0,a.kt)("inlineCode",{parentName:"p"},"404")," error. Let's just bypass authentication by disabling the ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider")," prop on ",(0,a.kt)("inlineCode",{parentName:"p"},"<Refine />")," by commenting it out:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/App.tsx"',title:'"src/App.tsx"'},"<Refine\n  ...\n  // authProvider={authProvider}\n/>\n")),(0,a.kt)("p",null,"Now if we click on the ",(0,a.kt)("inlineCode",{parentName:"p"},"Create")," canvas button on the navbar, we should be presented with a modal with the form inside:"),(0,a.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/create_canvas.png",alt:"react crud app supabase"}),(0,a.kt)("br",null),(0,a.kt)("p",null,"So, we are able to see the form for canvas ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action, but can't really create a canvas because we don't have a ",(0,a.kt)("inlineCode",{parentName:"p"},"user_id")," as we have authentication disabled at this point. We'll start creating canvases after we have our ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," page ready and once we have authentication fully implemented and reactivated."),(0,a.kt)("h2",{id:"refine--show-action"},(0,a.kt)("inlineCode",{parentName:"h2"},"<Refine />")," ",(0,a.kt)("inlineCode",{parentName:"h2"},"show")," Action"),(0,a.kt)("p",null,"We noted in the previous section that after a successful ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action, ",(0,a.kt)("inlineCode",{parentName:"p"},"useModalForm()")," is set to redirect the page to the ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," action."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," action represents a ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," request to the ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," table in our ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," database. It is done with the ",(0,a.kt)("inlineCode",{parentName:"p"},"dataProvider.getOne()")," method. In the ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasShow />")," component, it can be accessed via the ",(0,a.kt)("inlineCode",{parentName:"p"},"useShow()")," hook."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasShow />")," component looks like this:"),(0,a.kt)("details",null,(0,a.kt)("summary",null,"CanvasShow component code"),(0,a.kt)("p",null,(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/canvases/show.tsx"',title:'"src/pages/canvases/show.tsx"'},'import { useState } from "react";\nimport {\n    useCreate,\n    useGetIdentity,\n    useNavigation,\n    useShow,\n} from "@refinedev/core";\nimport { Button, Typography, Icons, Spin } from "@refinedev/antd";\n\nimport { CanvasItem, DisplayCanvas } from "components/canvas";\nimport { ColorSelect } from "components/color-select";\nimport { AvatarPanel } from "components/avatar";\nimport { colors } from "utility";\nimport { Canvas } from "types";\n\nconst { LeftOutlined } = Icons;\nconst { Title } = Typography;\n\nexport const CanvasShow: React.FC = () => {\n    const [color, setColor] = useState<typeof colors[number]>("black");\n\n    const { data: identity } = useGetIdentity();\n    const {\n        queryResult: { data: { data: canvas } = {} },\n    } = useShow<Canvas>();\n    const { mutate } = useCreate();\n    const { list, push } = useNavigation();\n\n    const onSubmit = (x: number, y: number) => {\n        if (!identity) {\n            return push("/login");\n        }\n\n        if (typeof x === "number" && typeof y === "number" && canvas?.id) {\n            mutate({\n                resource: "pixels",\n                values: {\n                    x,\n                    y,\n                    color,\n                    canvas_id: canvas?.id,\n                    user_id: identity.id,\n                },\n                successNotification: false,\n            });\n        }\n    };\n\n    return (\n        <div className="container">\n            <div className="paper">\n                <div className="paper-header">\n                    <Button\n                        type="text"\n                        onClick={() => list("canvases")}\n                        style={{ textTransform: "uppercase" }}\n                    >\n                        <LeftOutlined />\n                        Back\n                    </Button>\n                    <Title level={3}>{canvas?.name ?? canvas?.id ?? ""}</Title>\n                    <Button type="text" style={{ visibility: "hidden" }}>\n                        <LeftOutlined />\n                        Back\n                    </Button>\n                </div>\n\n                {canvas ? (\n                    <DisplayCanvas canvas={canvas}>\n                        {(pixels) =>\n                            pixels ? (\n                                <div\n                                    style={{\n                                        display: "flex",\n                                        justifyContent: "center",\n                                        gap: 48,\n                                    }}\n                                >\n                                    <div>\n                                        <ColorSelect\n                                            selected={color}\n                                            onChange={setColor}\n                                        />\n                                    </div>\n                                    <CanvasItem\n                                        canvas={canvas}\n                                        pixels={pixels}\n                                        onPixelClick={onSubmit}\n                                        scale={(20 / (canvas?.width ?? 20)) * 2}\n                                        active={true}\n                                    />\n                                    <div style={{ width: 120 }}>\n                                        <AvatarPanel pixels={pixels} />\n                                    </div>\n                                </div>\n                            ) : (\n                                <div className="spin-wrapper">\n                                    <Spin />\n                                </div>\n                            )\n                        }\n                    </DisplayCanvas>\n                ) : (\n                    <div className="spin-wrapper">\n                        <Spin />\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n')))),(0,a.kt)("p",null,"In the code above, we have two instances of data hooks in action. First, with the ",(0,a.kt)("inlineCode",{parentName:"p"},"useShow()")," hook, we are getting the created ",(0,a.kt)("inlineCode",{parentName:"p"},"canvas")," data to display it in the grid:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/canvases/show.tsx"',title:'"src/pages/canvases/show.tsx"'},"const {\n  queryResult: { data: { data: canvas } = {} },\n} = useShow<Canvas>();\n")),(0,a.kt)("p",null,"Additionally, we are letting another ",(0,a.kt)("inlineCode",{parentName:"p"},"mutation")," to create a ",(0,a.kt)("inlineCode",{parentName:"p"},"pixel")," in our ",(0,a.kt)("inlineCode",{parentName:"p"},"pixels")," table with the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/canvases/show.tsx"',title:'"src/pages/canvases/show.tsx"'},'const { mutate } = useCreate();\n\nconst onSubmit = (x: number, y: number) => {\n  if (typeof x === "number" && typeof y === "number" && canvas?.id) {\n    mutate({\n      resource: "pixels",\n      values: { x, y, color, canvas_id: canvas?.id },\n    });\n  }\n};\n')),(0,a.kt)("p",null,"Now that we have our ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasShow />")," component ready, let's start implementing ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," authentication for our app."),(0,a.kt)("h2",{id:"supabase-authentication-with-refine"},"Supabase Authentication with Refine"),(0,a.kt)("p",null,"Let's re-activate authentication by uncommenting ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider={authProvider}"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/App.tsx"',title:'"src/App.tsx"'},"<Refine\n  ...\n  authProvider={authProvider}\n/>\n")),(0,a.kt)("p",null,"And if we click on the ",(0,a.kt)("inlineCode",{parentName:"p"},"Create")," canvas button, we are redirected to ",(0,a.kt)("inlineCode",{parentName:"p"},"/login")," route that leads to the ",(0,a.kt)("inlineCode",{parentName:"p"},"404")," error."),(0,a.kt)("h3",{id:"email-authentication-with-supabase-in-refine"},"Email Authentication with Supabase in Refine"),(0,a.kt)("p",null,"For implementing authentication, we look back at the ",(0,a.kt)("inlineCode",{parentName:"p"},"App.tsx")," file."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"refine"),"'s ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," module has produced all the auth page variations we need to register an account, login, recover password and update password - along with the code for routing, ",(0,a.kt)("inlineCode",{parentName:"p"},"https")," requests and authentication providers."),(0,a.kt)("p",null,"Namely, authentication related routing has been added:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/App.tsx"',title:'"src/App.tsx"'},'<Refine\n  ...\n  routerProvider={{\n    ...routerProvider,\n    // auth routes start\n    routes: [\n      {\n        path: "/register",\n        element: <AuthPage type="register" />,\n      },\n      {\n        path: "/forgot-password",\n        element: <AuthPage type="forgotPassword" />,\n      },\n      {\n        path: "/update-password",\n        element: <AuthPage type="updatePassword" />,\n      },\n    ],\n  // auth routes end\n  }}\n/>\n')),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"LoginPage")," prop was also added:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/App.tsx"',title:'"src/App.tsx"'},'<Refine\n  LoginPage={() => (\n    <AuthPage\n      type="login"\n      providers={[\n        {\n          name: "github",\n          label: "Sign in with GitHub",\n        },\n      ]}\n    />\n/>\n')),(0,a.kt)("p",null,"However, we changed the ",(0,a.kt)("inlineCode",{parentName:"p"},"authProvider.checkAuth()")," method earlier in order to accommodate our public gallery. Because of this change, the ",(0,a.kt)("inlineCode",{parentName:"p"},"LoginPage")," prop gets deactivated. So, in the following section we are moving the login page to the ",(0,a.kt)("inlineCode",{parentName:"p"},"routes")," prop."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Custom Login")),(0,a.kt)("p",null,"In order to add a custom login route, we add a new entry to the ",(0,a.kt)("inlineCode",{parentName:"p"},"routes")," prop of ",(0,a.kt)("inlineCode",{parentName:"p"},"<Refine />"),". You can replace your App.tx with the following:"),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Show `App.tsx` code"),(0,a.kt)("p",null,(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/App.tsx"',title:'"src/App.tsx"'},'import { Refine } from "@refinedev/core";\nimport {\n    notificationProvider,\n    ReadyPage,\n    ErrorComponent,\n    Icons,\n    ConfigProvider,\n} from "@refinedev/antd";\nimport { dataProvider, liveProvider } from "@refinedev/supabase";\nimport routerProvider from "@refinedev/react-router-v6";\n\nimport { Layout } from "components/layout";\nimport { CanvasFeaturedList, CanvasList, CanvasShow } from "pages/canvases";\nimport { AuthPage } from "pages/auth";\n\nimport { supabaseClient } from "utility";\nimport authProvider from \'./authProvider\';\n\nimport "@refinedev/antd/dist/reset.css";\n\nimport "styles/style.css";\n\nconst { GithubOutlined } = Icons;\n\nfunction App() {\n    return (\n        <ConfigProvider\n            theme={{\n                token: {\n                    colorPrimary: "#3ecf8e",\n                    colorText: "#80808a",\n                    colorError: "#fa541c",\n                    colorBgLayout: "#f0f2f5",\n                    colorLink: "#3ecf8e",\n                    colorLinkActive: "#3ecf8e",\n                    colorLinkHover: "#3ecf8e",\n                },\n            }}\n        >\n            <Refine\n                dataProvider={dataProvider(supabaseClient)}\n                liveProvider={liveProvider(supabaseClient)}\n                authProvider={authProvider}\n                routerProvider={{\n                    ...routerProvider,\n                    routes: [\n                        {\n                            path: "/login",\n                            element: (\n                                <AuthPage\n                                    type="login"\n                                    providers={[\n                                        {\n                                            name: "github",\n                                            icon: (\n                                                <GithubOutlined\n                                                    style={{ fontSize: "18px" }}\n                                                />\n                                            ),\n                                            label: "Sign in with GitHub",\n                                        },\n                                    ]}\n                                    formProps={{\n                                        initialValues: {\n                                            email: "info@refine.dev",\n                                            password: "refine-supabase",\n                                        },\n                                    }}\n                                />\n                            ),\n                        },\n                        {\n                            path: "/register",\n                            element: <AuthPage type="register" />,\n                        },\n                        {\n                            path: "/forgot-password",\n                            element: <AuthPage type="forgotPassword" />,\n                        },\n                        {\n                            path: "/update-password",\n                            element: <AuthPage type="updatePassword" />,\n                        },\n                    ],\n                }}\n                DashboardPage={() => <CanvasFeaturedList />}\n                resources={[\n                    {\n                        name: "canvases",\n                        list: CanvasList,\n                        show: CanvasShow,\n                    },\n                ]}\n                notificationProvider={notificationProvider}\n                ReadyPage={ReadyPage}\n                catchAll={<ErrorComponent />}\n                Layout={Layout}\n            />\n        </ConfigProvider>\n    );\n}\n\nexport default App;\n')))),(0,a.kt)("p",null,"We are also using a customized version of the ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/antd/components/antd-auth-page/"},(0,a.kt)("inlineCode",{parentName:"a"},"<AuthPage />"))," component now. We will not discuss about customizing the ",(0,a.kt)("inlineCode",{parentName:"p"},"<AuthPage />")," component since it is pretty straight forward. But you can find the updated ",(0,a.kt)("inlineCode",{parentName:"p"},"<AuthPage />")," component in the ",(0,a.kt)("inlineCode",{parentName:"p"},"src/pages/auth")," directory."),(0,a.kt)("p",null,"If you haven't already, it is definitely worth spending time to go over the ",(0,a.kt)("inlineCode",{parentName:"p"},"<AuthPage />")," customization details ",(0,a.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/antd/components/antd-auth-page/#properties"},"here"),"."),(0,a.kt)("br",null),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Registering an Account")),(0,a.kt)("p",null,"Since we haven't created any account with the ",(0,a.kt)("inlineCode",{parentName:"p"},"auth.users")," table on our ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," server, we need to navigate to the ",(0,a.kt)("inlineCode",{parentName:"p"},"/register")," route where we are presented with the customized sign up form."),(0,a.kt)("p",null,"At this point, if we register with our email and a password, it gets added to the ",(0,a.kt)("inlineCode",{parentName:"p"},"auth.users")," table in ",(0,a.kt)("strong",{parentName:"p"},"Supabase"),"."),(0,a.kt)("p",null,"After registration, the user is automatically signed in and the browser redirects to the root route, which takes us to the ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases")," route thanks to ",(0,a.kt)("strong",{parentName:"p"},"refine"),"'s sensible routing defaults."),(0,a.kt)("p",null,"And now, since we are logged in, we should be able to create a canvas. After successful creation of a canvas, we should be redirected to ",(0,a.kt)("inlineCode",{parentName:"p"},"/canvases/:id"),":"),(0,a.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/registering.png",alt:"react crud app supabase"}),(0,a.kt)("br",null),(0,a.kt)("p",null,"Feel free to create a few more canvases and draw on them so that the gallery gets populated."),(0,a.kt)("p",null,"With the main features functioning now, let's focus on adding and activating third party authentication."),(0,a.kt)("p",null,"We have a ",(0,a.kt)("inlineCode",{parentName:"p"},"providers")," prop on ",(0,a.kt)("inlineCode",{parentName:"p"},"<AuthPage />"),".  We want to add GitHub authentication as well."),(0,a.kt)("h3",{id:"github-authentication-with-supabase-in-refine"},"GitHub Authentication with Supabase in Refine"),(0,a.kt)("p",null,"We implemented GitHub authentication with ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," in our app."),(0,a.kt)("p",null,"In order to do so, we just need to add the following object to the ",(0,a.kt)("inlineCode",{parentName:"p"},"providers")," prop in ",(0,a.kt)("inlineCode",{parentName:"p"},"<AuthPage />")," component:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  name: "github",\n  icon: <GithubOutlined style={{ fontSize: "18px" }} />,\n  label: "Sign in with GitHub",\n}\n')),(0,a.kt)("p",null,"In our ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," backend, we have to configure and enable GitHub authentication. Feel free to use this ",(0,a.kt)("a",{parentName:"p",href:"https://supabase.com/docs/guides/auth/auth-github"},(0,a.kt)("strong",{parentName:"a"},"Supabase")," guide"),"."),(0,a.kt)("p",null,"And now we should be able to sign in to our app with GitHub as well."),(0,a.kt)("h2",{id:"implementing-a-public-dashboard-with-refine"},"Implementing a Public Dashboard with Refine"),(0,a.kt)("p",null,"Now it's time to focus on the ",(0,a.kt)("inlineCode",{parentName:"p"},"DashboardPage")," prop. We put the ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasFeaturedList />")," in this page:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'},"<Refine\n  Dashboard={() => <CanvasFeaturedList />}\n/>\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"DashboardPage")," prop places its component at the ",(0,a.kt)("inlineCode",{parentName:"p"},"/")," route and it precedence over the first item in the ",(0,a.kt)("inlineCode",{parentName:"p"},"resources")," prop."),(0,a.kt)("p",null,"So, now if we visit the root route we can see the ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasFeaturedList />")," component, and not the ",(0,a.kt)("inlineCode",{parentName:"p"},"<CanvasList />")," component."),(0,a.kt)("p",null,"There will not be any item in the dashboard page because ",(0,a.kt)("inlineCode",{parentName:"p"},"is_featured")," is set to ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," for a canvas by default. At this stage, in order to get a list of featured canvases, we have to set ",(0,a.kt)("inlineCode",{parentName:"p"},"is_featured: true")," from ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," dashboard for some of the canvases created."),(0,a.kt)("p",null,"I've done that and the featured canvases are listed in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Home")," route:"),(0,a.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-09-refine-pixels-3/public_last.png",alt:"react crud app supabase"}),(0,a.kt)("br",null),(0,a.kt)("h2",{id:"summary"},"Summary"),(0,a.kt)("p",null,"In this post, we added ",(0,a.kt)("inlineCode",{parentName:"p"},"canvases")," resource to our ",(0,a.kt)("inlineCode",{parentName:"p"},"<Refine />")," component. We implemented ",(0,a.kt)("inlineCode",{parentName:"p"},"list")," action on a public gallery and a dashboard page and the ",(0,a.kt)("inlineCode",{parentName:"p"},"show")," action to display a canvas. The ",(0,a.kt)("inlineCode",{parentName:"p"},"create")," action is implemented from inside a modal accessible on a button click. While working through these, we inspected into individual data provider methods and hooks for these actions."),(0,a.kt)("p",null,"We also saw how ",(0,a.kt)("strong",{parentName:"p"},"refine")," handles a simple email/password based authentication out-of-the-box. We then went ahead implemented social login using ",(0,a.kt)("inlineCode",{parentName:"p"},"GitHub")," authentication provider."),(0,a.kt)("p",null,"In the next article, we'll move things to the next level by adding live collaboration features using ",(0,a.kt)("strong",{parentName:"p"},"refine"),"'s ",(0,a.kt)("strong",{parentName:"p"},"Supabase")," ",(0,a.kt)("inlineCode",{parentName:"p"},"liveProvider"),"."))}m.isMDXComponent=!0}}]);